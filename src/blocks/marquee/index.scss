/**
 * Block: Marquee - Frontend Styles
 *
 * Frontend specific styles for the Marquee block. Handles scrolling animations,
 * responsive behavior, and visual effects for continuously moving content.
 *
 * @file        blocks/marquee/index.scss
 * @package     OrbiTools
 * @subpackage  orbitools/blocks
 * @author      OrbiTools Team
 * @since       1.0.0
 * @version     1.0.0
 *
 * @see         blocks/marquee/editor.scss - Editor styles
 */

// Base class for Marquee block
$elem_base: 'orb-marquee';

.#{$elem_base} {

    position: relative;
    width: 100%;
    overflow: hidden;
    box-sizing: border-box;
    padding: 0;

    &[data-marquee-initialized="true"] {
        .#{$elem_base}__content {
            opacity: 1;
        }
    }

    &.alignfull:not(.has-spacing) {
        .#{$elem_base}__wrapper {
            margin-left: calc(var(--gutter-page) * -1);
            margin-right: calc(var(--gutter-page) * -1);
            min-width: calc(100% + calc(var(--gutter-page) * 2));
        }
    }
    // =======================
    // Core Animation Setup
    // =======================

    // Wrapper contains the scrolling content
    .#{$elem_base}__wrapper {
        display: flex;
        width: max-content;
        min-width: 100%;
        overflow: hidden;
        // RTL support
        [dir="rtl"] & {
            direction: ltr; // Keep marquee direction independent of text direction
        }
    }

    // Content container - holds the actual inner blocks
    .#{$elem_base}__content {
        display: flex;
        align-items: center;
        flex-shrink: 0;
        opacity: 0;
        gap: var(--gutter, var(--wp--style--block-gap, 20px));
    }

    // =======================
    // Overlay Effects
    // =======================

    .#{$elem_base}__overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        pointer-events: none;
        z-index: 1;
    }

    &.has-overlay-color {
        .#{$elem_base}__overlay {
            background: var(--marquee-overlay-color, transparent);

            // Use mask for better performance - reveal color at edges, hide in center
            mask-image: linear-gradient(
                90deg,
                black 0%,
                transparent 10%,
                transparent 90%,
                black 100%
            );
            -webkit-mask-image: linear-gradient(
                90deg,
                black 0%,
                transparent 10%,
                transparent 90%,
                black 100%
            );

            // RTL support for horizontal overlays
            [dir="rtl"] & {
                mask-image: linear-gradient(
                    270deg,
                    black 0%,
                    transparent 10%,
                    transparent 90%,
                    black 100%
                );
                -webkit-mask-image: linear-gradient(
                    270deg,
                    black 0%,
                    transparent 10%,
                    transparent 90%,
                    black 100%
                );
            }
        }

        // Vertical overlay gradient
        &.#{$elem_base}--y .#{$elem_base}__overlay {
            mask-image: linear-gradient(
                180deg,
                black 0%,
                transparent 10%,
                transparent 90%,
                black 100%
            );
            -webkit-mask-image: linear-gradient(
                180deg,
                black 0%,
                transparent 10%,
                transparent 90%,
                black 100%
            );
        }

        // Fallback for browsers that don't support mask-image
        @supports not (mask-image: linear-gradient(90deg, transparent, black)) {
            .#{$elem_base}__overlay {
                background: linear-gradient(
                    90deg,
                    var(--marquee-overlay-color, transparent) 0%,
                    transparent 10%,
                    transparent 90%,
                    var(--marquee-overlay-color, transparent) 100%
                );

                [dir="rtl"] & {
                    background: linear-gradient(
                        270deg,
                        var(--marquee-overlay-color, transparent) 0%,
                        transparent 10%,
                        transparent 90%,
                        var(--marquee-overlay-color, transparent) 100%
                    );
                }
            }

            &.#{$elem_base}--y .#{$elem_base}__overlay {
                background: linear-gradient(
                    180deg,
                    var(--marquee-overlay-color, transparent) 0%,
                    transparent 10%,
                    transparent 90%,
                    var(--marquee-overlay-color, transparent) 100%
                );
            }
        }
    }
}

// =======================
// Accessibility
// =======================

// High contrast mode support
@media (prefers-contrast: high) {
    .#{$elem_base} {
        &.has-overlay-color .#{$elem_base}__overlay {
            display: none; // Remove overlay in high contrast
        }
    }
}

// =======================
// Editor-specific Overrides
// =======================

.block-editor-block-preview__content {
    .#{$elem_base} {
        // Slower animation in editor preview
        &__wrapper {
            animation-duration: calc(var(--marquee-speed, 10s) * 2);
        }
    }
}

// =======================
// Theme Integration
// =======================

// Support for theme colors
.has-text-color .#{$elem_base} {
    &__content {
        color: inherit;
    }
}

.has-background .#{$elem_base} {
    background: inherit;
}

// =======================
// Performance Optimizations
// =======================

.#{$elem_base} {
    // Contain layout shifts
    contain: layout style;

    // Hardware acceleration
    &__wrapper {
        will-change: transform;
        transform: translateZ(0); // Force GPU acceleration
    }
}

// =======================
// Error States
// =======================

// When content is too short for proper marquee effect
.#{$elem_base}--insufficient-content {
    .#{$elem_base}__wrapper {
        animation: none;
        justify-content: center;
    }
}
